function Popup(t){function e(t){t||(t={}),o(t),a()}function o(t){t.selected||(t.selected={}),l.popupContainer=$("#"+t.popupContainer)||$("#popup"),l.selected={yearDefault:t.selected.yearDefault||"2012",year:t.selected.year||"2012",yearType:t.selected.yearType||"G",race:t.selected.race||"S",state:t.selected.state||"US",date:t.selected.date||""},l.paperWidth=t.paperWidth||_vectorWidth,l.paperHeight=t.paperHeight||l.paperWidth*l.stageRatio}function i(t,e,o){l.popupContainer.html(t),"undefined"!=typeof e&&"undefined"!=typeof o&&r(e,o)}function p(){return y}function n(){!C&&h&&(C=!0,y=!0,l.popupContainer.addClass("is-active"))}function a(t){l.popupContainer.removeClass("is-active"),s(t)}function s(t){"boolean"==typeof t&&(m=t),C=!1,y=!1}function r(t,e){var o=$("#map-interactive").outerWidth(),i=$("#map-interactive").outerHeight(),p=(o-$("#map-interactive").outerWidth())/o*100,n=t/o*100+2,a=e/i*100+2,s=l.popupContainer.outerWidth()/o*100,r=l.popupContainer.outerHeight()/i*100,u=n+s,c=a+r,d=0,f=0;c>95?(g.isBottom=!1,f=100-(a-4)):(g.isBottom=!0,f=a),u>95?(g.isRight=!1,d=100-(n-4)):(g.isRight=!0,d=p+n),g.isBottom?l.popupContainer.css({bottom:"",top:f+"%"}):a-4-r>10?l.popupContainer.css({top:"",bottom:f+"%"}):l.popupContainer.css({top:"",bottom:"10%"}),g.isRight?l.popupContainer.css({right:"",left:d+"%"}):n-4-s>10?l.popupContainer.css({left:"",right:d+"%"}):l.popupContainer.css({left:"",right:"10%"}),h=!0}function u(t){"boolean"==typeof t&&(m=t)}function c(){return m}function d(t,e){f("popupCloseClicked"),l.paperWidth=t,l.paperHeight=e}function f(t,e){$.event.trigger({type:t,params:e})}var l={},h=!1,C=!1,g={isRight:!0,isStaticLeft:!1,isBottom:!0,isStaticTop:!1,isStaticBottom:!1},m=!1,y=!1;return e(t),{setSelectedState:function(t){l.selected.state=t},setSelectedDate:function(t){l.selected.date=t},setPopup:i,movePopup:r,showPopup:n,hidePopup:a,setFixedPosition:u,getFixedPosition:c,isShowing:p,resize:d}}function popupLoadComplete(){}